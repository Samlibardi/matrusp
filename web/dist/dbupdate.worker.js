!function(e){var t={};function r(a){if(t[a])return t[a].exports;var s=t[a]={i:a,l:!1,exports:{}};return e[a].call(s.exports,s,s.exports,r),s.l=!0,s.exports}r.m=e,r.c=t,r.d=function(e,t,a){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(r.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)r.d(a,s,function(t){return e[t]}.bind(null,s));return a},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=196)}({196:function(e,t){self.importScripts("dblib.js"),self.progress=0,self.addProgress=function(e){self.progress+=e,self.postMessage(self.progress)},self.setProgress=function(e){self.progress=e,self.postMessage(self.progress)},navigator.onLine||(self.setProgress(1),self.close());var r=matruspDB.metadata.get("ETag").then(async e=>{var t=await fetch("db/db.json",{method:"GET",headers:{"If-None-Match":e||""}});if(!t.ok){if(304==t.status)return;throw new Error(`Server returned code ${t.status} for DB request`)}self.addProgress(.1),await Promise.all([matruspDB.trigrams.clear(),matruspDB.lectures.clear()]),await function(e){self.addProgress(.1);var t={length:0};function r(e,r){t[e]||(t[e]={length:0}),t[e][r.codigo]||(t[e][r.codigo]=0),t[e][r.codigo]++,t[e].length++,t.length++}e.forEach(e=>{var t=new Set;e.turmas&&(e.turmas.forEach(e=>{e&&e.horario&&e.horario.forEach(e=>{e&&(hourInit=parseInt(e.inicio.slice(0,2)),hourInit<12?t.add("matutino"):hourInit<18?t.add("vespertino"):t.add("noturno"),hourEnd=parseInt(e.fim.slice(0,2)),hourEnd>19?t.add("noturno"):hourEnd>13?t.add("vespertino"):t.add("matutino"))})}),e.periodos=[...t])});var a=matruspDB.lectures.bulkPut(e).then(()=>self.addProgress(.2)),s={};e.forEach(e=>{dbutil.trigramsFromString(dbutil.canonize(e.nome)).forEach(t=>{r(t,e)}),dbutil.trigramsFromString(e.codigo).forEach(t=>{r(t,e)}),s[e.unidade]||(s[e.unidade]=new Set),s[e.unidade].add(e.departamento)});var o=matruspDB.units.bulkPut(Object.values(s).map(e=>[...e]),Object.keys(s));for(var n in t)if("length"!==n){var u=Math.sqrt(Math.log(t.length/t[n].length));for(var i in delete t[n].length,t[n])t[n][i]=u*Math.log(1+t[n][i])}self.addProgress(.2),delete t.length;var d=matruspDB.trigrams.bulkPut(Object.values(t),Object.keys(t)).then(()=>self.addProgress(.2));return Promise.all([a,d,o])}(await t.json()),await matruspDB.metadata.put(t.headers.get("ETag"),"ETag")}),a=matruspDB.metadata.get("ETag-courses").then(async e=>{var t=await fetch("db/cursos.json",{method:"GET",headers:{"If-None-Match":e||""}});if(!t.ok){if(304==t.status)return;throw new Error(`Server returned code ${t.status} for courses DB request`)}self.postMessage(.1),await matruspDB.courses.clear(),await matruspDB.courses.bulkPut(await t.json()),await matruspDB.metadata.put(t.headers.get("ETag"),"ETag-courses")}),s=matruspDB.metadata.get("ETag-campi").then(async e=>{var t=await fetch("db/campi.json",{method:"GET",headers:{"If-None-Match":e||""}});if(!t.ok){if(304==t.status)return;throw new Error(`Server returned code ${t.status} for campi DB request`)}self.addProgress(.1),await matruspDB.campi.clear();var r=await t.json();await matruspDB.campi.bulkPut(Object.values(r),Object.keys(r)),await matruspDB.metadata.put(t.headers.get("ETag"),"ETag-campi")});Promise.all([r,a,s]).then(()=>{self.postMessage(1),self.close()}).catch(e=>{console.error(e),self.postMessage(1),self.close()})}});